.. _10X:

Parsing 10X Genomics V(D)J data
================================================================================

Example data
--------------------------------------------------------------------------------

10X Genomics provides an example data set of Ig V(D)J processed by the Cell
Ranger pipeline, which is available for download from their
`Single Cell Immune Profiling <https://support.10xgenomics.com/single-cell-vdj/datasets/3.0.0/vdj_v1_hs_pbmc2_b>`__
support site.

Combining Change-O formatted data with 10X annotations
--------------------------------------------------------------------------------

Change-O does not currently support a formal :ref:`MakeDb` option for 10X V(D)J
data. However, you can easily merge a TSV file conforming to the
:ref:`Change-O <Standard>` with a CSV annotation file provided by 10X.

First, generate Change-O formatted data from the 10X V(D)J FASTA files using the
steps below::

	AssignGenes.py igblast -s 10x.fasta -b ~/share/igblast \
	   --organism human --loci ig --format blast
	MakeDb.py igblast -i 10x_igblast.fmt7 -s 10x.fasta \
	   -r IMGT_Human_IGHV.fasta IMGT_Human_IGHD.fasta IMGT_Human_IGHJ.fasta \
	   --regions --scores

.. seealso::

    See the :ref:`IgBLAST usage guide <IgBLAST>` for further details regarding
    the setup and use of IgBLAST.

After the Change-O file has been built, it can then be merged with 10X annotation
file. A simple script,
`merge10.py <merge10x.py <https://bitbucket.org/kleinstein/immcantation/src/tip/scripts/merge10x.py>`__,
to perform the merge is provided on the
`Immcantation Bitbucket repository <https://bitbucket.org/kleinstein/immcantation>`__
in the ``scripts`` directory. The following example shows how to merge the
Change-O file (``10x_igblast_db-pass.tab``) with the 10X annotation file
(``10x_annotations.csv``) and save it as ``10x_annotated_db-pass.tab``::

	merge10x.py 10x_igblast_db-pass.tab 10x_annotations.csv 10x_annotated_db-pass.tab

.. warning::

    The resulting table contains two V and J segment assignments corresponding to
    those generated by IgBLAST and those generated by Cell Ranger.